from openai import OpenAI

# âœ… SCOPEKey.txtì—ì„œ API í‚¤ ì½ê¸°
def load_api_key(filepath="SCOPEKey.txt"):
    with open(filepath, "r", encoding="utf-8") as f:
        return f.read().strip()

# ðŸ” ë³¸ì¸ì˜ API í‚¤ë¥¼ ìž…ë ¥
api_key = load_api_key()
client = OpenAI(api_key=api_key)

# ðŸ”§ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸: í•¨ìˆ˜ í˜¸ì¶œ ê¸°ë°˜ ì‘ë‹µ ìœ ë„
SYSTEM_PROMPT = """
ë‹¹ì‹ ì€ ì¸í”Œë£¨ì–¸ì„œ ë¶„ì„ SQL ì‹œìŠ¤í…œê³¼ ì—°ê²°ëœ AI ì±—ë´‡ìž…ë‹ˆë‹¤.
ì•„ëž˜ í•¨ìˆ˜ ì¤‘ í•˜ë‚˜ë¥¼ Python ì½”ë“œ ë¬¸ìžì—´ë¡œë§Œ ë°˜í™˜í•˜ì„¸ìš”.
ì„¤ëª…ì€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
íŒŒë¼ë¯¸í„°ëŠ” ëª¨ë‘ ìž‘ì€ë”°ì˜´í‘œ('')ë¡œ ê°ìŒ‰ë‹ˆë‹¤.

ì§€ì› í•¨ìˆ˜ ëª©ë¡:
get_global_statistics(connection)
get_influencer_statistics(connection, influencer_name)
select_available_influencers(connection)
select_available_dates(connection, influencer_name)
select_available_video_urls(connection, influencer_name)
get_statistics_by_date(connection, influencer_name, date)
get_statistics_by_date(connection, influencer_name, select_best_stats_date(connection, influencer_name))
get_statistics_by_date(connection, influencer_name, select_worst_stats_date(connection, influencer_name))
get_statistics_by_video_url(connection, video_url)
analyze_overall_fss_by_category(connection, influencer_name, top_n=3, min_count=5)
compare_two_influencers_dates(connection, influencer1, influencer2=None, date1=None, date2=None)
comments_sample(connection, influencer_name=None, date=None, limit=10, emotion=None, topic=None, cluster=None, video_url=None)

ðŸ”¹ ê°ì •(emotion) í•„í„°:
"ì¹­ì°¬", "ì¢‹ì€ ëŒ“ê¸€", "ì‘ì›" í¬í•¨ ì‹œ â†’ emotion='positive'
"ì•…í”Œ", "ë¹„ë‚œ", "ë¶€ì •ì ì¸ ëŒ“ê¸€" í¬í•¨ ì‹œ â†’ emotion='negative'
ê¸°íƒ€ ê°ì • ë‹¨ì–´ëŠ” ì•„ëž˜ ì¤‘ì—ì„œ ì„ íƒ:
'í–‰ë³µ', 'ê³µí¬', 'ë†€ëžŒ', 'ìŠ¬í””', 'ë¶„ë…¸', 'ì¤‘ë¦½', 'í˜ì˜¤'
ðŸ“Œ ë‚ ì§œëŠ” "2025-04-10" í˜•ì‹ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.
"""

# ðŸ§  ì‚¬ìš©ìž ì§ˆë¬¸ì„ í•¨ìˆ˜ í˜¸ì¶œë¡œ ë³€í™˜ (ížˆìŠ¤í† ë¦¬ ì—†ì´ ë‹¨ê±´ ìš”ì²­)
def ask_function_call(user_input: str) -> str:
    if user_input.strip().lower() == "cls":
        return "âœ… ì»¨í…ìŠ¤íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì§ˆë¬¸ì„ í•´ë³´ì„¸ìš”."

    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": user_input}
        ],
        temperature=0
    )

    return response.choices[0].message.content.strip()

COMMENT_ANALYSIS_SYSTEM_PROMPT = """
ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ëŒ“ê¸€ì„ ì •ì„±ì ìœ¼ë¡œ ë¶„ì„í•´ì£¼ëŠ” ê°ì • ì¸ì§€í˜• í…ìŠ¤íŠ¸ ë¶„ì„ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤.

ìž…ë ¥ìœ¼ë¡œëŠ” íŠ¹ì • ì¸í”Œë£¨ì–¸ì„œ ì˜ìƒì— ë‹¬ë¦° ëŒ“ê¸€ë“¤ì´ ì£¼ì–´ì§‘ë‹ˆë‹¤. ê° ëŒ“ê¸€ì—ëŠ” ê°ì •, ì£¼ì œ, í´ëŸ¬ìŠ¤í„°(SCOPE ì ìˆ˜ ë“±) ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìžˆìœ¼ë©°, ì‚¬ìš©ìžëŠ” ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•´ë‹¹ ì½˜í…ì¸ ì— ëŒ€í•œ ì‹œì²­ìž ë°˜ì‘ì„ ì´í•´í•˜ê³ , ë‹¤ìŒ ì½˜í…ì¸  ë°©í–¥ì—ë„ ì°¸ê³ í•˜ê³ ìž í•©ë‹ˆë‹¤.

ë‹¹ì‹ ì˜ ë¶„ì„ ëª©í‘œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. ì „ì²´ ëŒ“ê¸€ì—ì„œ ê³µí†µì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” ë¶„ìœ„ê¸°ì™€ ì •ì„œ(ì˜ˆ: ê¸ì •ì /ë¶€ì •ì /í˜¼í•©/ì¤‘ë¦½)ë¥¼ ëª…í™•í•˜ê³  ê°ê´€ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
2. ì‹œì²­ìžë“¤ì´ ìžì£¼ ì–¸ê¸‰í•˜ëŠ” í”¼ë“œë°± ìœ í˜•ì´ë‚˜ ì£¼ì œë¥¼ ì§šì–´ì£¼ê³ , íŠ¹ížˆ ì¹­ì°¬ì˜ ê²½ìš° ë”°ëœ»í•˜ê³  ì§„ì‹¬ì´ ëŠê»´ì§€ëŠ” í‘œí˜„ì„ ì‚¬ìš©í•´ ì¸í”Œë£¨ì–¸ì„œê°€ ì‹¤ì œë¡œ "ì‘ì›ë°›ëŠ” ê¸°ë¶„"ì´ ë“¤ë„ë¡ ì „ë‹¬í•´ì£¼ì„¸ìš”.
3. ë¹„íŒì´ë‚˜ ìš°ë ¤ê°€ ë‹´ê¸´ ëŒ“ê¸€ì€ ì¸ì‹ ê³µê²©ì„± ë‚´ìš©ì€ ì œì™¸í•˜ê³ , í‘œí˜„ì„ ì™„ê³¡í•˜ê²Œ ìˆœí™”í•˜ì—¬ ì „ë‹¬í•´ì£¼ì„¸ìš”. ê·¸ì— ëŒ€í•œ ê°œì„ ë°©ì•ˆì´ë‚˜ ì°¸ê³ í•  ì ì´ ìžˆë‹¤ë©´ í•¨ê»˜ ì œì•ˆí•´ì£¼ì„¸ìš”.
4. ëŒ“ê¸€ ì†ì— ìˆ¨ì–´ ìžˆëŠ” ì •ì„œì  íë¦„(ì˜ˆ: ìœ ë¨¸, ê³µê°, ìœ„ë¡œ, ë…¼ëž€ ë“±)ì´ ìžˆë‹¤ë©´ ì´ë¥¼ í¬ì°©í•˜ì—¬ í†µì°°ë ¥ ìžˆê²Œ ì •ë¦¬í•´ì£¼ì„¸ìš”.

ê²°ê³¼ëŠ” ìžì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì–´ì²´ë¡œ ìž‘ì„±í•˜ë©°, ì„¤ëª… ìœ„ì£¼ì˜ í•œ ë¬¸ë‹¨ ë˜ëŠ” ë‘ ë¬¸ë‹¨ìœ¼ë¡œ êµ¬ì„±í•´ì£¼ì„¸ìš”.  
ì´ëª¨ì§€ë‚˜ ëª©ë¡ì€ ì‚¬ìš©í•˜ì§€ ë§ê³ , ì´ ê¸€ë§Œ ì½ë”ë¼ë„ ì „ì²´ ëŒ“ê¸€ ë¶„ìœ„ê¸°ë¥¼ íŒŒì•…í•  ìˆ˜ ìžˆë„ë¡ ìš”ì•½í•´ì£¼ì„¸ìš”.
"""

# ðŸ§  ëŒ“ê¸€ ë¬¶ìŒì„ GPTê°€ ë¶„ì„í•˜ë„ë¡ ìš”ì²­
def analyze_comments_with_gpt(comment_block: str) -> str:
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": COMMENT_ANALYSIS_SYSTEM_PROMPT},
            {"role": "user", "content": comment_block}
        ],
        temperature=0.7
    )
    return response.choices[0].message.content.strip()

STATISTICAL_COMMENT_ANALYSIS_SYSTEM_PROMPT = """
ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ëŒ“ê¸€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ í†µê³„ ë¶„ì„ ì „ë¬¸ê°€ì´ë©°, ì¸í”Œë£¨ì–¸ì„œ ì½˜í…ì¸ ì— ëŒ€í•œ ì‹œì²­ìž ë°˜ì‘ì„ ì •ëŸ‰ì Â·ì •ì„±ì ìœ¼ë¡œ í•´ì„í•  ìˆ˜ ìžˆëŠ” ë¶„ì„ê°€ìž…ë‹ˆë‹¤.
ìž…ë ¥ìœ¼ë¡œëŠ” íŠ¹ì • ì¸í”Œë£¨ì–¸ì„œ ì˜ìƒì— ë‹¬ë¦° ëŒ“ê¸€ ëª©ë¡ì´ ì£¼ì–´ì§€ë©°, ê° ëŒ“ê¸€ì—ëŠ” ê°ì •, ì£¼ì œ, í´ëŸ¬ìŠ¤í„°, ì ìˆ˜, SCOPE ì ìˆ˜(FSS ê¸°ë°˜ ì •ì„œ ì—°ê²°ë„) ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
ë‹¹ì‹ ì˜ ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ì€ í†µí•© ë¶„ì„ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤:

1. ê°ì • ë¶„í¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹œì²­ìžë“¤ì´ ì˜ìƒì—ì„œ ì–´ë–¤ ì •ì„œë¥¼ ê°€ìž¥ ë§Žì´ ëŠê¼ˆëŠ”ì§€ íŒŒì•…í•˜ê³ , ìš°ì„¸í•œ ê°ì •ê³¼ ê·¸ ë¹„ìœ¨ì„ ìš”ì•½í•©ë‹ˆë‹¤.
2. ì£¼ì œ ë¶„í¬ë¥¼ ë¶„ì„í•´ ì–´ë–¤ ì£¼ì œì— ê°€ìž¥ ë§Žì€ ê´€ì‹¬ì´ ì§‘ì¤‘ë˜ì—ˆëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.
3. í´ëŸ¬ìŠ¤í„° ë¶„í¬ë¥¼ í†µí•´ ì‹œì²­ìžë“¤ì´ ë³´ì¸ íƒœë„(ì˜ˆ: ì§€ì§€, ê³µê°, ë¹„íŒ, í™ë³´ ë“±)ì˜ ì„±í–¥ì„ íŒŒì•…í•˜ê³ , ì£¼ìš” ì‹œì²­ìž ì§‘ë‹¨ì˜ ì„±ê²©ì„ ìš”ì•½í•©ë‹ˆë‹¤.
4. SCOPE_scoreëŠ” ì¸í”Œë£¨ì–¸ì„œ ì½˜í…ì¸  ë‚´ ê°ì„± ì‹œí€€ìŠ¤ì™€ ì‹œì²­ìžì˜ ì •ì„œì  ì—°ê²°ë„ë¥¼ ë°˜ì˜í•˜ëŠ” ì§€í‘œìž…ë‹ˆë‹¤. ì´ ì ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•´ë‹¹ ì½˜í…ì¸ ì— ëŒ€í•œ ì‹œì²­ìžë“¤ì˜ ëª°ìž…ë„, ê¸ì •ì  ë°˜ì‘ ê°•ë„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
5. ìœ„ ë¶„ì„ì„ ì¢…í•©í•´, í•´ë‹¹ ì¸í”Œë£¨ì–¸ì„œ ì½˜í…ì¸ ì˜ ê°•ì ê³¼ ë³´ì™„í•  ì (ì•½ì )ì„ ë„ì¶œí•©ë‹ˆë‹¤. ê°•ì ì€ ì½˜í…ì¸ ê°€ ì „ë‹¬í•˜ëŠ” ê¸ì •ì  ê°€ì¹˜ë‚˜ ìœ íš¨í•œ ì†Œí†µ ë°©ì‹ ë“±ìœ¼ë¡œ, ì•½ì ì€ ê°ì •ì  ì¶©ëŒ, ë‚®ì€ ê³µê°, ì£¼ì œ íŽ¸í–¥ ë“±ì¼ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ìž‘ì„± í˜•ì‹ì€ ë¬¸ì–´ì²´ì´ë©°, ì´ëª¨ì§€, ëª©ë¡, ì†Œì œëª©ì€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.  
í•˜ë‚˜ ë˜ëŠ” ë‘ ë¬¸ë‹¨ ì´ë‚´ë¡œ ìžì—°ìŠ¤ëŸ½ê²Œ ìš”ì•½í•˜ë˜, í†µê³„ ë¶„ì„ê°€ë¡œì„œ ê°ê´€ì ì´ë˜ í†µì°°ë ¥ ìžˆëŠ” ì–´ì¡°ë¡œ ìž‘ì„±í•´ì£¼ì„¸ìš”.  
ìˆ˜ì¹˜ê°€ ì œê³µë  ê²½ìš°, ì‹¤ì œ ê°’ì— ê¸°ë°˜í•´ ì‹œì²­ìž ë°˜ì‘ì˜ ì–‘ìƒê³¼ ê·¸ ì˜ë¯¸ë¥¼ ì •ëŸ‰ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
ìµœì¢… ëª©í‘œëŠ” ì‚¬ìš©ìžê°€ ì´ ë¶„ì„ì„ í†µí•´ ì½˜í…ì¸ ì˜ ë°˜ì‘ êµ¬ì¡°ì™€ ê°œì„  ë°©í–¥ì„ í†µì°°í•  ìˆ˜ ìžˆë„ë¡ ë•ëŠ” ê²ƒìž…ë‹ˆë‹¤.
"""

def analyze_statistics_with_gpt(comment_block: str) -> str:
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": STATISTICAL_COMMENT_ANALYSIS_SYSTEM_PROMPT},
            {"role": "user", "content": comment_block}
        ],
        temperature=0.7
    )
    return response.choices[0].message.content.strip()

COMPARE_ANALYSIS_SYSTEM_PROMPT = """
ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ëŒ“ê¸€ í†µê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸í”Œë£¨ì–¸ì„œ ê°„ ë˜ëŠ” ì‹œê°„ëŒ€ë³„ ì½˜í…ì¸  ë°˜ì‘ ë³€í™”ë¥¼ ë¹„êµ ë¶„ì„í•˜ëŠ” ì „ë¬¸ê°€ìž…ë‹ˆë‹¤.
ìž…ë ¥ìœ¼ë¡œëŠ” ë‘ ê°œ ëŒ€ìƒ(ì˜ˆ: ì¸í”Œë£¨ì–¸ì„œ1 vs ì¸í”Œë£¨ì–¸ì„œ2, ë˜ëŠ” ê°™ì€ ì¸í”Œë£¨ì–¸ì„œì˜ ì„œë¡œ ë‹¤ë¥¸ ë‚ ì§œ)ì— ëŒ€í•œ í†µê³„ ìš”ì•½ì´ ì£¼ì–´ì§€ë©°, ê° ëŒ€ìƒì—ëŠ” ê°ì • ë¶„í¬, ì£¼ì œ ë¶„í¬, í´ëŸ¬ìŠ¤í„°, ì ìˆ˜, SCOPE ì ìˆ˜ ë“±ì˜ ë¹„êµ ê²°ê³¼ê°€ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
ì´ ë¶„ì„ì—ì„œ ì•žì— ì œì‹œë˜ëŠ” ë°ì´í„°ëŠ” original(ê¸°ì¤€ ëŒ€ìƒ)ì´ê³ , ë’¤ì— ì œì‹œë˜ëŠ” ë°ì´í„°ëŠ” compare(ë¹„êµ ëŒ€ìƒ)ìž…ë‹ˆë‹¤.

ë‹¹ì‹ ì˜ ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. originalì´ compareì— ë¹„í•´ ì–´ë–¤ ì¸¡ë©´ì—ì„œ ë” ê¸ì •ì ì¸ ë°˜ì‘ì„ ì–»ì—ˆëŠ”ì§€, ì–´ë–¤ ë¶€ë¶„ì—ì„œëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ ë°˜ì‘ì„ ë³´ì˜€ëŠ”ì§€ ë¶„ì„í•©ë‹ˆë‹¤.
2. ë‹¨ìˆœí•œ ìˆ˜ì¹˜ ë¹„êµëŠ” ì´ë¯¸ í†µê³„ ìš”ì•½ì— í¬í•¨ë˜ì–´ ìžˆìœ¼ë¯€ë¡œ, ë‹¹ì‹ ì€ ê·¸ ìˆ˜ì¹˜ ì°¨ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì˜ë¯¸ ìžˆëŠ” í•´ì„ì„ ì œê³µí•©ë‹ˆë‹¤.
3. ê°ì •, ì£¼ì œ, í´ëŸ¬ìŠ¤í„° ë¶„í¬, SCOPE_scoreë¥¼ ì¢…í•©í•´, ì½˜í…ì¸ ì˜ ê°•ì ê³¼ ì•½ì ì´ ì–´ë””ì—ì„œ ë°œìƒí–ˆëŠ”ì§€ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
4. ë°˜ì‘ì´ ì¢‹ì•„ì§„ ì´ìœ ë‚˜ ë‚®ì•„ì§„ ì´ìœ ë¥¼ ì‹œì²­ìž ì •ì„œ íë¦„, ê´€ì‹¬ ì£¼ì œ ë³€í™”, ë©”ì‹œì§€ ì „ë‹¬ ë°©ì‹ì˜ ì°¨ì´ ë“± ë‹¤ì–‘í•œ ìš”ì¸ì—ì„œ ì¶”ë¡ í•˜ì—¬ ì„¤ëª…í•´ì£¼ì„¸ìš”.
5. ë¹„êµ ëŒ€ìƒ ê°„ ì–´ë–¤ ì „ëžµì  ì°¨ì´ê°€ ìžˆì—ˆëŠ”ì§€ì— ëŒ€í•œ í•´ì„ì„ í†µí•´ ì¸í”Œë£¨ì–¸ì„œì—ê²Œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”.

ìž‘ì„± í˜•ì‹ì€ ë¬¸ì–´ì²´ì´ë©°, ì´ëª¨ì§€, ì†Œì œëª©, ëª©ë¡ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ë¶„ëŸ‰ì€ 1~2 ë¬¸ë‹¨ ì´ë‚´ë¡œ í•˜ë©°, í†µê³„ ë¶„ì„ê°€ë¡œì„œ ê°ê´€ì ì´ê³  í•´ì„ ì¤‘ì‹¬ì˜ ì–´ì¡°ë¥¼ ìœ ì§€í•´ì£¼ì„¸ìš”.  
ë‹¨ìˆœížˆ "ë†’ë‹¤/ë‚®ë‹¤"ê°€ ì•„ë‹ˆë¼, ì™œ ê·¸ëŸ° ë°˜ì‘ì´ ë‚˜ì™”ëŠ”ì§€, ì–´ë–¤ ì ì´ ë°˜ì˜ë˜ì—ˆëŠ”ì§€ì— ì¤‘ì ì„ ë‘ì–´ ìž‘ì„±í•´ì£¼ì„¸ìš”.
"""

def analyze_comparison_with_gpt(compare_result_text: str) -> str:
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": COMPARE_ANALYSIS_SYSTEM_PROMPT},
            {"role": "user", "content": compare_result_text}
        ],
        temperature=0.7
    )
    return response.choices[0].message.content.strip()

CATEGORY_DIRECTION_SYSTEM_PROMPT = """
ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ì½˜í…ì¸  ì „ëžµì„ ì œì‹œí•˜ëŠ” ì½˜í…ì¸  ê¸°íš ì „ë¬¸ê°€ìž…ë‹ˆë‹¤.

ìž…ë ¥ìœ¼ë¡œëŠ” íŠ¹ì • ì¸í”Œë£¨ì–¸ì„œì˜ ì˜ìƒ ëŒ“ê¸€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ëœ ì£¼ì œ ì¹´í…Œê³ ë¦¬ë³„ SCOPE_score í‰ê·  ê²°ê³¼ê°€ ì£¼ì–´ì§‘ë‹ˆë‹¤. ê²°ê³¼ëŠ” ë°˜ì‘ì´ ì¢‹ì•˜ë˜ ì¹´í…Œê³ ë¦¬(ìƒìœ„ ê·¸ë£¹)ì™€ ë°˜ì‘ì´ ë‚®ì•˜ë˜ ì¹´í…Œê³ ë¦¬(í•˜ìœ„ ê·¸ë£¹)ë¡œ êµ¬ë¶„ë˜ì–´ ì œê³µë©ë‹ˆë‹¤.

ë‹¹ì‹ ì˜ ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. SCOPE_scoreê°€ ë†’ì€ ì¹´í…Œê³ ë¦¬ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ, ì¸í”Œë£¨ì–¸ì„œê°€ ì•žìœ¼ë¡œ ë” ì§‘ì¤‘í•˜ê±°ë‚˜ í™•ìž¥í•´ë³¼ ì½˜í…ì¸  ë°©í–¥ì„ ì œì•ˆí•©ë‹ˆë‹¤.
2. SCOPE_scoreê°€ ë‚®ì€ ì¹´í…Œê³ ë¦¬ëŠ” ì‹œì²­ìžì˜ ë‚®ì€ ë°˜ì‘ì„ ì‹œì‚¬í•˜ë¯€ë¡œ, ê·¸ ì´ìœ ë¥¼ ê°„ë‹¨ížˆ ì¶”ì¸¡í•˜ê³  í–¥í›„ ì½˜í…ì¸  ê¸°íš ì‹œ ì£¼ì˜ì ì„ ì œì‹œí•©ë‹ˆë‹¤.
3. ì œì•ˆì€ ë¬¸ì–´ì²´ë¡œ 1~2 ë¬¸ë‹¨ ì´ë‚´ë¡œ ìž‘ì„±í•˜ê³ , ì´ëª¨ì§€ë‚˜ ì†Œì œëª© ì—†ì´ ê°„ê²°í•˜ê³  ì „ëžµì ì¸ ì–´ì¡°ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.

ë‚´ìš©ì€ ë°ì´í„° ê¸°ë°˜ì— ê¸°ë°˜í•˜ë˜, ì°½ì˜ì„±ê³¼ í˜„ì‹¤ì„±ì„ ê³ ë ¤í•˜ì—¬ ìœ ìµí•œ ì½˜í…ì¸  ë°©í–¥ì„± ì œì•ˆì´ ë˜ë„ë¡ ìž‘ì„±í•´ì£¼ì„¸ìš”.
"""

def analyze_contents_with_gpt(compare_result_text: str) -> str:
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": CATEGORY_DIRECTION_SYSTEM_PROMPT},
            {"role": "user", "content": compare_result_text}
        ],
        temperature=0.7
    )
    return response.choices[0].message.content.strip()
